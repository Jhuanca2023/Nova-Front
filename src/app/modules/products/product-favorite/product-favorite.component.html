<div class="container mx-auto px-4 py-8">
  <!-- Header con breadcrumbs y título -->
  <div class="mb-8">
    <div class="text-sm breadcrumbs mb-4">
      <ul>
        <li><a routerLink="/">Inicio</a></li>
        <li><a routerLink="/products">Productos</a></li>
        <li class="text-primary">Favoritos</li>
      </ul>
    </div>

    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
      <div>
        <h1 class="text-3xl font-bold flex items-center">
          <lucide-angular name="heart" class="w-8 h-8 mr-3 text-primary"></lucide-angular>
          Mis Productos Favoritos
        </h1>
        <p class="text-muted-foreground mt-2">Guarda aquí los productos que deseas para más tarde</p>
      </div>

      @if (hasFavorites()) {
        <div class="flex flex-wrap gap-2">
          <button
            class="btn btn-outline btn-sm flex items-center gap-2"
            (click)="addAllToCart()"
            [disabled]="isAdding()">
            @if (isAdding()) {
              <span class="loading loading-spinner loading-xs"></span>
            } @else {
              <lucide-angular name="shopping-cart" class="w-4 h-4"></lucide-angular>
            }
            Añadir todos al carrito
          </button>

          <button
            class="btn btn-error btn-sm flex items-center gap-2 btn-remove-all"
            (click)="clearAllFavorites()"
            [disabled]="isLoading()">
            <lucide-angular name="trash-2" class="w-4 h-4"></lucide-angular>
            Eliminar todos
          </button>
        </div>
      }
    </div>
  </div>

  <!-- Loading state -->
  @if (isLoading()) {
    <div class="flex justify-center items-center py-16">
      <span class="loading loading-heart loading-lg text-primary"></span>
    </div>
  }
  <!-- Empty state when no favorites -->
  @else if (!hasFavorites()) {
    <div class="empty-favorites card bg-base-100 shadow-lg p-12 text-center max-w-2xl mx-auto">
      <div class="flex flex-col items-center">
        <div class="w-24 h-24 rounded-full bg-base-200 flex items-center justify-center mb-6">
          <lucide-angular name="heart-off" class="w-12 h-12 text-muted-foreground"></lucide-angular>
        </div>
        <h2 class="text-2xl font-bold mb-3">No tienes productos favoritos</h2>
        <p class="text-muted-foreground max-w-md mx-auto mb-8">
          Explora nuestra tienda y añade productos a tus favoritos para verlos aquí.
          Guarda tus productos preferidos para comprarlos más tarde.
        </p>
        <a routerLink="/products" class="btn btn-primary">
          Ver productos
        </a>
      </div>
    </div>
  }
  <!-- Products grid -->
  @else {
    <div class="grid grid-cols-1 gap-8 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">
      @for (favorite of favoriteProducts(); track favorite.id; let i = $index) {
        <div class="favorite-item relative group">
          <!-- Botón de eliminar favorito -->
          <button
            class="absolute top-2 right-2 z-10 btn btn-circle btn-sm btn-error opacity-0 group-hover:opacity-100 transition-opacity"
            (click)="removeFromFavorites(favorite.id)"
            [disabled]="isRemoving() === favorite.id"
            aria-label="Eliminar de favoritos">
            @if (isRemoving() === favorite.id) {
              <span class="loading loading-spinner loading-xs"></span>
            } @else {
              <lucide-angular name="trash-2" class="w-4 h-4"></lucide-angular>
            }
          </button>

          <!-- Product card -->
          <product-card [product]="favorite"></product-card>

          <!-- Etiqueta de favorito -->
          <div class="absolute top-2 left-2 badge badge-primary gap-2 backdrop-blur-sm">
            <lucide-angular name="heart" class="w-3 h-3"></lucide-angular>
            Favorito
          </div>
        </div>
      }
    </div>

    <!-- Recomendaciones si hay pocos favoritos -->
    @if (favoriteProducts().length < 4) {
      <div class="mt-16 pt-8 border-t border-base-300">
        <h2 class="text-2xl font-bold mb-6">Productos recomendados</h2>
        <div class="bg-primary/5 p-4 rounded-lg mb-6">
          <p class="text-center text-base-content/80">
            Basado en tus favoritos, estos productos podrían interesarte
          </p>
        </div>

        <!-- Aquí se pueden agregar recomendaciones de productos -->
      </div>
    }
  }
</div>
