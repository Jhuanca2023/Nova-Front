<form [formGroup]="profileForm" (ngSubmit)="saveChanges()">
  <div class="divider mb-6">Información Personal</div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- Nombre -->
    <div class="form-control">
      <label class="label">
        <span class="label-text">Nombre</span>
        <span class="label-text-alt text-error">*</span>
      </label>
      <input
        type="text"
        formControlName="firstName"
        [readOnly]="!isEditing()"
        class="input input-bordered w-full"
        [ngClass]="{
          'input-error': profileForm.get('firstName')?.invalid && profileForm.get('firstName')?.touched,
          'opacity-70': !isEditing()
        }"
      />
      @if (profileForm.get('firstName')?.invalid && profileForm.get('firstName')?.touched) {
        <label class="label">
          <span class="label-text-alt text-error">Este campo es requerido</span>
        </label>
      }
    </div>

    <!-- Apellido -->
    <div class="form-control">
      <label class="label">
        <span class="label-text">Apellidos</span>
        <span class="label-text-alt text-error">*</span>
      </label>
      <input
        type="text"
        formControlName="lastName"
        [readOnly]="!isEditing()"
        class="input input-bordered w-full"
        [ngClass]="{
          'input-error': profileForm.get('lastName')?.invalid && profileForm.get('lastName')?.touched,
          'opacity-70': !isEditing()
        }"
      />
      @if (profileForm.get('lastName')?.invalid && profileForm.get('lastName')?.touched) {
        <label class="label">
          <span class="label-text-alt text-error">Este campo es requerido</span>
        </label>
      }
    </div>

    <!-- Email -->
    <div class="form-control">
      <label class="label">
        <span class="label-text">Email</span>
        <span class="label-text-alt text-error">*</span>
      </label>
      <div class="relative">
        <input
          type="email"
          formControlName="email"
          [readOnly]="!isEditing() || authService.isGoogleUser()"
          class="input input-bordered w-full pr-10"
          [ngClass]="{
            'input-error': profileForm.get('email')?.invalid && profileForm.get('email')?.touched,
            'opacity-70': !isEditing() || authService.isGoogleUser()
          }"
        />
        @if (authService.isGoogleUser()) {
          <div class="absolute right-3 top-1/2 transform -translate-y-1/2">
            <lucide-angular name="lock" class="w-4 h-4 text-base-content/50"></lucide-angular>
          </div>
        }
      </div>

      @if (authService.isGoogleUser()) {
        <label class="label">
          <span class="label-text-alt text-info flex items-center gap-1">
            <lucide-angular name="info" class="w-3 h-3"></lucide-angular>
            El email no se puede modificar (cuenta vinculada a Google)
          </span>
        </label>
      } @else if (profileForm.get('email')?.invalid && profileForm.get('email')?.touched) {
        <label class="label">
          @if (profileForm.get('email')?.errors?.['required']) {
            <span class="label-text-alt text-error">El email es requerido</span>
          } @else if (profileForm.get('email')?.errors?.['email']) {
            <span class="label-text-alt text-error">Formato de email inválido</span>
          }
        </label>
      }
    </div>

    <!-- Teléfono -->
    <div class="form-control">
      <label class="label">
        <span class="label-text">Teléfono</span>
      </label>
      <div class="relative">
        <input
          type="tel"
          formControlName="phone"
          [readOnly]="!isEditing()"
          placeholder="+54 9518746352"
          class="input input-bordered w-full pl-10"
          [ngClass]="{
            'input-error': profileForm.get('phone')?.invalid && profileForm.get('phone')?.touched,
            'opacity-70': !isEditing()
          }"
        />
        <div class="absolute left-3 top-1/2 transform -translate-y-1/2">
          <lucide-angular name="phone" class="w-5 h-5 text-base-content/50"></lucide-angular>
        </div>
      </div>
      @if (profileForm.get('phone')?.invalid && profileForm.get('phone')?.touched) {
        <label class="label">
          <span class="label-text-alt text-error">Formato inválido (ej: +54612345678)</span>
        </label>
      }
    </div>
  </div>

  @if (authService.isGoogleUser()) {
    <div class="alert alert-info mt-6">
      <lucide-angular name="info" class="w-5 h-5"></lucide-angular>
      <div>
        <span class="font-bold">Cuenta vinculada con Google</span>
        <p class="text-sm ">
          Algunos datos como tu email provienen de tu cuenta de Google y
          no pueden ser modificados.
        </p>
      </div>
    </div>
  }

  <div class="flex justify-end gap-4 mt-8">
    @if (!isEditing()) {
      <button
        type="button"
        class="btn btn-primary"
        (click)="toggleEdit()"
      >
        <lucide-angular name="edit" class="w-4 h-4 mr-2"></lucide-angular>
        Editar perfil
      </button>
    } @else {
      <button
        type="button"
        class="btn btn-ghost"
        (click)="toggleEdit()"
        [disabled]="profileService.isSaving()"
      >
        Cancelar
      </button>
      <button
        type="submit"
        class="btn btn-primary"
        [disabled]="profileForm.invalid || profileService.isSaving()"
      >
        @if (profileService.isSaving()) {
          <span class="loading loading-spinner loading-xs mr-2"></span>
          Guardando...
        } @else {
          <lucide-angular name="save" class="w-4 h-4 mr-2"></lucide-angular>
          Guardar cambios
        }
      </button>
    }
  </div>
</form>
